// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Vehicule {
  id              Int           @id @unique @default(autoincrement())
  traqueur        String        @db.VarChar(255)
  nom             String        @db.VarChar(255)
  immatriculation String        @db.VarChar(255)
  numero_chassis  String        @db.VarChar(255)
  carburant       String
  assurance       Assurance[]
  photo           String        @db.VarChar(255)
  maintenances    Maintenance[]


  @@map(name: "vehicules")
}

model Assurance {
  id            Int      @id @unique @default(autoincrement())
  numero_police String   @db.VarChar(255)
  date_debut    String
  date_fin      String
  vehicule      Vehicule @relation(fields: [vehicule_id], references: [id], onDelete: Cascade)
  vehicule_id   Int

  @@map(name: "assurances")
}

model Fournisseur {
  id             Int     @id @unique @default(autoincrement())
  nom            String  @db.VarChar(255)
  prenom         String  @db.VarChar(255)
  nom_entreprise String  @db.VarChar(255)
  numero_tel     String  @db.VarChar(10)
  adresse        String  @db.VarChar(255)
  description    String  @db.VarChar(500)
  pieces         Piece[]


  @@map(name: "fournisseurs")
}

model Piece {
  id             Int                 @id @unique @default(autoincrement())
  nom            String              @unique @db.VarChar(255)
  quantite       Int
  fournisseur    Fournisseur         @relation(fields: [fournisseur_id], references: [id])
  fournisseur_id Int
  maintenaces    Maintenance_Piece[]

  @@map(name: "pieces")
}

model Mecanicien {
  id             Int    @id @unique @default(autoincrement())
  nom            String @db.VarChar(255)
  prenom         String @db.VarChar(255)
  nom_entreprise String @db.VarChar(255)
  numero_tel     String @db.VarChar(10)
  adresse        String @db.VarChar(255)
  description    String @db.VarChar(500)

  @@map(name: "mecaniciens")
}

model Maintenance {
  id          Int                 @id @unique @default(autoincrement())
  nom         String              @db.VarChar(255)
  vehicule    Vehicule            @relation(fields: [vehicule_id], references: [id])
  vehicule_id Int
  type        TypeMaintenance     @relation(fields: [type_id], references: [id])
  type_id     Int
  pieces      Maintenance_Piece[]
  description String              @db.VarChar(500)
  cout        Decimal
  fichier     String              @db.VarChar(255)

  @@map(name: "maintenances")
}

model TypeMaintenance {
  id           Int           @id @default(autoincrement())
  type         String        @db.VarChar(255)
  maintenances Maintenance[]

  @@map(name: "type_de_maintenance")
}

model Maintenance_Piece {
  maintenance    Maintenance @relation(fields: [maintenance_id], references: [id])
  maintenance_id Int
  piece          Piece       @relation(fields: [piece_id], references: [id])
  piece_id       Int


  @@id([maintenance_id, piece_id])
  @@map(name: "maintenance_pieces")
}
